(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[877],{4768:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/settings",function(){return t(1206)}])},6771:function(e,n,t){"use strict";t.d(n,{Z:function(){return w}});var r=t(5893),i=t(7294),o=t(1163),a=t(9008),s=t.n(a),c=t(8298),l=t(2734),u=t(2293),d=t(9520),p=t(155),f=t(6886),h=t(3321),g=t(5861),m=t(7357);function y(e){var n=e.children,t=(0,c.Z)({disableHysteresis:!0,threshold:24});return(0,i.cloneElement)(n,{elevation:t?4:0})}var v=function(){var e=(0,i.useState)(!1),n=e[0],t=e[1],o=((0,i.useCallback)((function(){t(!n)}),[n]),(0,l.Z)());return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(y,{children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{color:"transparent",elevation:0,children:(0,r.jsx)(d.Z,{maxWidth:"xl",sx:{padding:0},children:(0,r.jsx)(p.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,r.jsx)(f.ZP,{item:!0,children:(0,r.jsx)(h.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,r.jsx)(g.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:o.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,r.jsx)(m.Z,{sx:{height:o.spacing(18)}})]})})})};function x(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){x(e,n,t[n])}))}return e}var j=!1;var w=function(e){var n=(0,o.useRouter)();return(0,i.useEffect)((function(){if(n.isReady&&!j){var e,t,r,i;j=!0;var o=(null===(e=n.query)||void 0===e?void 0:e.apiKey)||"",a=(null===(t=n.query)||void 0===t?void 0:t.apiPort)||"9170",s=!1;if((null===(r=n.query)||void 0===r?void 0:r.apiKey)||(s=!0,o=window.prompt("Please enter your API key",o)),(null===(i=n.query)||void 0===i?void 0:i.apiPort)||(s=!0,a=window.prompt("Please enter your API port (default: 9170)",a)),s&&o&&a){var c=n.asPath.split("?")[0];n.replace({pathname:c.includes(".html")?c:"".concat(c,".html"),query:b({},n.query,{apiKey:o,apiPort:a})})}}}),[n]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s(),{children:[(0,r.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,r.jsx)("link",{rel:"canonical",href:e.url}),(0,r.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,r.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,r.jsx)(v,{}),e.children]})}},6317:function(e,n,t){"use strict";t.d(n,{D:function(){return o},X:function(){return i}});var r=t(7294);function i(e){navigator.permissions.query({name:"clipboard-write"}).then((function(n){"granted"!==n.state&&"prompt"!==n.state||navigator.clipboard.writeText(e)}))}function o(e){var n=(0,r.useRef)();return(0,r.useEffect)((function(){n.current=e})),n.current}},9375:function(e,n,t){"use strict";t.d(n,{C:function(){return s}});var r=t(4051),i=t.n(r);function o(e,n,t,r,i,o,a){try{var s=e[o](a),c=s.value}catch(l){return void t(l)}s.done?n(c):Promise.resolve(c).then(r,i)}function a(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)}))}}var s=function(){function e(n,t,r){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.port=n||9170,this.apiKey=t;var o=this;a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.connect();case 2:o.websocket=e.sent,r&&o.websocket&&o.websocket.readyState===o.websocket.OPEN&&r();case 4:case"end":return e.stop()}}),e)})))()}var n=e.prototype;return n.close=function(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.close()},n.connect=function(){var e=this;return a(i().mark((function n(){var t;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=new WebSocket("ws://".concat(window.location.hostname||"localhost",":").concat(e.port,"/api/websocket")),n.next=3,new Promise((function(e){t.onopen=function(){return e()}}));case 3:return t.onmessage=function(n){if("string"===typeof n.data){var t=JSON.parse(n.data);t&&e.onEvent&&e.onEvent(t)}},n.abrupt("return",t);case 5:case"end":return n.stop()}}),n)})))()},n.getData=function(e){this.websocket&&(console.log("Get data:",e),this.websocket.send(JSON.stringify({event:"GET_DATA","api-key":this.apiKey,modules:e})))},n.getSettings=function(){this.websocket&&(console.log("Get settings"),this.websocket.send(JSON.stringify({event:"GET_SETTINGS","api-key":this.apiKey})))},n.registerDataListener=function(e){this.websocket&&(console.log("Register data listener:",e),this.websocket.send(JSON.stringify({event:"REGISTER_DATA_LISTENER","api-key":this.apiKey,modules:e})))},n.sendEvent=function(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(JSON.stringify({event:"events",data:{"api-key":this.apiKey,data:e}}))},n.updateSetting=function(e,n){this.websocket&&(console.log("Update setting:",{key:e,value:n}),this.websocket.send(JSON.stringify({event:"UPDATE_SETTING","api-key":this.apiKey,setting:e,value:n})))},e}()},1206:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ee}});var r=t(5893),i=t(7294),o=t(9520),a=t(6771),s=t(4051),c=t.n(s),l=t(2734),u=t(6886),d=t(8456),p=t(1163),f=t(5317),h=t(7262),g=t(9375),m=t(5934),y=t(8619),v=t(9294),x=t(796),b=t(9953),j=t(3395),w=t(9653),k=t(4054),Z=t(7709),S=t(7109),P=t(3946),O=t(1713),C=t(699),E=t(8849),I=t(6317),A=t(8396),N=t(657),_=t(7645),T=t(8951),D=t(6514),R=t(8462),G=t(1425),W=t(3321),z=t(6486),K=t.n(z);var q=function(e){var n=e.setting,t=e.listIn,o=e.open,a=e.setOpen,s=e.handleChanged,c=(0,i.useState)([]),d=c[0],p=c[1],h=n.name,g=n.description,m=n.icon;(0,i.useEffect)((function(){!o&&t&&p(t)}),[t,o]);var j=(0,l.Z)(),w=(0,A.Z)(j.breakpoints.down("md"));return(0,r.jsxs)(N.Z,{fullScreen:w,fullWidth:!0,maxWidth:"lg",open:o,scroll:"paper",PaperProps:{style:{background:j.palette.background.paper}},children:[(0,r.jsxs)(_.Z,{children:[(0,r.jsx)(E.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.7,path:m,style:{marginRight:j.spacing(1)}}),h]}),(0,r.jsx)(T.Z,{sx:{margin:j.spacing(0,3)},children:g}),(0,r.jsx)(D.Z,{children:(0,r.jsxs)(R.Z,{children:[d.map((function(e,n){return(0,r.jsx)(v.ZP,{children:(0,r.jsxs)(u.ZP,{container:!0,alignItems:"center",children:[(0,r.jsx)(u.ZP,{item:!0,xs:4,sx:{marginRight:j.spacing(1)},children:(0,r.jsx)(C.Z,{id:"name",label:"Name",fullWidth:!0,variant:"outlined",value:e.name,onChange:function(e){var t=K().cloneDeep(d);console.log("Update name:",n,t,t[n]),t&&t[n]&&(t[n].name=e.target.value,p(t))}})}),(0,r.jsx)(u.ZP,{item:!0,xs:!0,sx:{marginLeft:j.spacing(1)},children:(0,r.jsx)(C.Z,{id:"value",label:"Value",fullWidth:!0,variant:"outlined",value:e.value,onChange:function(e){var t=K().cloneDeep(d);console.log("Update value:",n,t,t[n]),t&&t[n]&&(t[n].value=e.target.value,p(t))}})}),(0,r.jsx)(u.ZP,{item:!0,children:(0,r.jsx)(P.Z,{"aria-label":"Remove",size:"large",onClick:function(){var e=K().cloneDeep(d);e.splice(n,1),p(e)},children:(0,r.jsx)(E.Icon,{id:"remove-item",title:"Remove",size:.8,path:f.S6N})})})]})},n)})),(0,r.jsxs)(y.Z,{onClick:function(){var e=K().cloneDeep(d);e.push({name:"",value:""}),p(e)},children:[(0,r.jsx)(x.Z,{children:(0,r.jsx)(E.Icon,{id:"add",title:"Add",size:1,path:f.qX5})}),(0,r.jsx)(b.Z,{primary:"Add",secondary:"Add a new item"})]})]})}),(0,r.jsxs)(G.Z,{children:[(0,r.jsx)(W.Z,{onClick:function(){a(!1)},color:"primary",variant:"outlined",children:"Cancel"}),(0,r.jsx)(W.Z,{onClick:function(){a(!1),s(d.sort((function(e,n){return e.name.localeCompare(n.name)})))},color:"primary",variant:"outlined",children:"Save"})]})]})};function L(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var F=function(e){var n=e.keyIn,t=e.valueIn,o=e.handleChanged,a=function(e){T(e)},s=function(e){a(e.target.value)},c=(0,i.useState)(!1),d=c[0],p=c[1],h=(0,i.useState)(!1),g=h[0],A=h[1],N=(0,i.useState)(t),_=N[0],T=N[1],D=(0,i.useMemo)((function(){return t!==_}),[t,_]),R=Q[n],G=R.name,W=R.description,z=R.icon,K=R.containerDisabled,F=R.isList,U=R.isPassword,B=R.minimum,J=(0,l.Z)(),M=function(e){var n=e.children;return F?(0,r.jsx)(y.Z,{onClick:function(){return p(!0)},children:n}):(0,r.jsx)(v.ZP,{children:n})};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(M,{children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{children:(0,r.jsx)(E.Icon,{id:"icon",title:G,size:1,path:z})}),(0,r.jsx)(b.Z,{primary:G,secondary:W,sx:{maxWidth:"64%",userSelect:"none"}}),(0,r.jsx)(j.Z,{sx:{width:420,textAlign:"end"},children:(0,r.jsxs)(u.ZP,{container:!0,alignItems:"center",justifyContent:"flex-end",children:[(0,r.jsx)(u.ZP,{item:!0,children:"boolean"===typeof _?(0,r.jsx)(w.Z,{edge:"end",disabled:K,checked:_,onChange:function(e,n){a(n)}}):"string"===typeof t&&"api_key"===n?(0,r.jsx)(k.Z,{fullWidth:!0,variant:"outlined",children:(0,r.jsx)(Z.Z,{type:"text",disabled:!0,value:_,endAdornment:(0,r.jsxs)(S.Z,{position:"end",children:[(0,r.jsx)(P.Z,{"aria-label":"Generate Api Key",onClick:function(){a((0,m.Z)())},edge:"end",size:"large",sx:{margin:J.spacing(-1,-.5)},children:(0,r.jsx)(E.Icon,{id:"generate-api-key",title:"Generate API Key",size:1,path:f.VmU})}),(0,r.jsx)(P.Z,{"aria-label":"Copy to clipboard",onClick:function(){return(0,I.X)(String(_))},size:"large",sx:{margin:J.spacing(-1,-.5)},children:(0,r.jsx)(E.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.8,path:f.a0Z})})]})})}):"string"===typeof t&&"string"===typeof _&&"log_level"===n?(0,r.jsx)(O.Z,{id:n,options:["DEBUG","INFO","WARNING","ERROR","CRITICAL"],renderInput:function(e){return(0,r.jsx)(C.Z,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){L(e,n,t[n])}))}return e}({},e,{variant:"outlined"}))},onChange:function(e,n){n&&a(n)},sx:{width:210},value:_}):"string"===typeof t&&U?(0,r.jsx)(k.Z,{variant:"outlined",children:(0,r.jsx)(Z.Z,{type:g?"text":"password",defaultValue:_,onChange:s,endAdornment:(0,r.jsx)(S.Z,{position:"end",children:(0,r.jsx)(P.Z,{"aria-label":"Toggle visibility",onClick:function(){A(!g)},onMouseDown:function(e){e.preventDefault()},size:"large",children:(0,r.jsx)(E.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.8,path:g?f.rgx:f.DqW})})})})}):"string"===typeof t?(0,r.jsx)(C.Z,{type:"text",defaultValue:_,disabled:K,onChange:s,variant:"outlined"}):"number"===typeof t?(0,r.jsx)(C.Z,{error:!!B&&Number(_)<B,type:"number",disabled:K,inputProps:{minimum:B},defaultValue:_,onChange:s,variant:"outlined"}):""}),F?"":(0,r.jsx)(u.ZP,{item:!0,children:(0,r.jsx)(P.Z,{disabled:!1===D,onClick:function(){o(n,_)},sx:{margin:J.spacing(1)},children:(0,r.jsx)(E.Icon,{id:"save",title:"Save",size:1,path:f.JTj,style:{opacity:D?1:.25}})})})]})})]})}),F&&Array.isArray(_)?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(q,{setting:Q[n],listIn:_,open:d,setOpen:p,handleChanged:function(e){T(e),o(n,e)}})}):""]})},U=t(5861),B=t(5113);var J,M=function(e){var n=e.name,t=e.description,i=e.children;return(0,r.jsxs)(u.ZP,{container:!0,direction:"row",item:!0,xs:12,children:[(0,r.jsxs)(u.ZP,{item:!0,xs:4,style:{userSelect:"none"},children:[(0,r.jsx)(U.Z,{component:"h3",variant:"h5",children:n}),(0,r.jsx)(U.Z,{variant:"subtitle1",children:t})]}),(0,r.jsx)(u.ZP,{item:!0,xs:8,children:(0,r.jsx)(B.Z,{children:(0,r.jsx)(R.Z,{children:i})})})]})};function V(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function X(e,n,t,r,i,o,a){try{var s=e[o](a),c=s.value}catch(l){return void t(l)}s.done?n(c):Promise.resolve(c).then(r,i)}function H(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function $(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,i,o=[],a=!0,s=!1;try{for(t=t.call(e);!(a=(r=t.next()).done)&&(o.push(r.value),!n||o.length!==n);a=!0);}catch(c){s=!0,i=c}finally{try{a||null==t.return||t.return()}finally{if(s)throw i}}return o}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return V(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return V(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Q={autostart:{name:"Autostart",description:"Automatically start the application on startup",icon:f.USr},log_level:{name:"Log Level",description:"Log level for the application",icon:f.eLz},port_api:{name:"API Port",description:"Port for the API and WebSocket",icon:f.A0p},additional_media_directories:{name:"Additional Media Directories",description:"Additional media directories for the media endpoint",icon:f.Rmq,isList:!0}};var Y=function(){var e=$((0,h.r)(),2),n=e[0],t=e[1],o=(0,i.useState)(!1),a=o[0],s=o[1],f=(0,p.useRouter)().query,m=(0,i.useCallback)((function(e){if(console.log("Event:",e),"SETTINGS_RESULT"===e.type){console.log("Settings result data:",e.data);var n={};console.log("settingsMap:",Q);var r=Object.keys(Q);e.data.sort((function(e,n){return r.indexOf(e.key)>r.indexOf(n.key)?1:-1})).forEach((function(e){n[e.key]=e.value})),console.log("Settings:",n),t(n)}}),[t]),y=(0,i.useCallback)((function(e,n){var t;console.log("Setup WebSocketConnection"),J=new g.C(e,n,(t=c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:J.getSettings();case 1:case"end":return e.stop()}}),e)})),function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(e){X(o,r,i,a,s,"next",e)}function s(e){X(o,r,i,a,s,"throw",e)}a(void 0)}))})),J.onEvent=m}),[m]),v=(0,i.useCallback)((function(e,r){J.updateSetting(e,r),t(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){H(e,n,t[n])}))}return e}({},n,H({},e,r)))}),[n,t]);(0,i.useEffect)((function(){!a&&f&&f.apiKey&&(s(!0),y(Number(f.apiPort)||9170,String(f.apiKey)))}),[a,y,f]);var x=(0,l.Z)();return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(u.ZP,{container:!0,direction:"column",spacing:2,alignItems:"stretch",sx:{marginBottom:x.spacing(8),padding:x.spacing(2)},children:n?(0,r.jsx)(M,{name:"General",description:"General settings",children:(0,r.jsx)(r.Fragment,{children:Object.keys(n).map((function(e,t){return(0,r.jsx)(F,{keyIn:e,valueIn:n[e],handleChanged:v},t)}))})}):(0,r.jsx)(u.ZP,{container:!0,direction:"row",justifyContent:"center",sx:{margin:x.spacing(2,0,10)},children:(0,r.jsx)(d.Z,{})})})})};var ee=function(){return(0,r.jsx)(a.Z,{title:"Settings",url:"https://system-bridge.timmo.dev",description:"Frontend for System Bridge",children:(0,r.jsx)(o.Z,{component:"article",maxWidth:"xl",children:(0,r.jsx)(Y,{})})})}}},function(e){e.O(0,[662,702,291,318,316,699,713,767,208,774,888,179],(function(){return n=4768,e(e.s=n);var n}));var n=e.O();_N_E=n}]);