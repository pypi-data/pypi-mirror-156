(self.webpackChunkpaper_admin=self.webpackChunkpaper_admin||[]).push([[9434],{7758:function(){window.addEventListener("keydown",(function(t){if(!t.defaultPrevented&&t.ctrlKey){const e=document.querySelector(".paper-pagination");if(!e)return;switch(t.key){case"Left":case"ArrowLeft":e.querySelector('.page-link[aria-label="Previous"]').click();break;case"Right":case"ArrowRight":e.querySelector('.page-link[aria-label="Next"]').click();break;default:return}t.preventDefault()}}))},423:function(t,e,n){"use strict";n.r(e);var o=n(1474);function s(t){this._buildTree(t)}s.prototype._createNode=function(t){const e=t.dataset;return{pk:parseInt(e.id),parent:parseInt(e.parent),element:t,childs:[]}},s.prototype._addNode=function(t){return!(!t||"number"!=typeof t.pk)&&(this._nodes[t.pk]=t,isNaN(t.parent)&&this._roots.push(t),!0)},s.prototype.getNode=function(t){if(null===this._nodes)throw new Error("tree is empty");if(!(t in this._nodes))throw new Error(`node ${t} not found`);return this._nodes[t]},s.prototype._buildTree=function(t){const e=[];this._nodes={},this._roots=[],t.forEach(function(t){const n=this._createNode(t);for(this._addNode(n);e.length;){const t=e[0];if(n.parent===t.pk)return t.childs.push(n.pk),void e.unshift(n);e.shift()}e.unshift(n)}.bind(this))},s.prototype.getRoots=function(){if(null===this._roots)throw new Error("tree is empty");return this._roots.map(function(t){return t.element}.bind(this))},s.prototype.getDescendants=function(t){return this.getNode(t).childs.reduce(function(t,e){const n=this.getNode(e);return n&&(t.push(n.element),t=t.concat(this.getDescendants(e))),t}.bind(this),[])};var r=s;function a(t,e){if(this.opts=Object.assign({url:null,tree:!1,handler:".handler",disabledClass:"disabled"},e),this.table=t,this.tbody=t.querySelector("tbody"),!this.tbody)throw new Error("table body not found");this.tree=null,this._createSortable()}a.prototype._createSortable=function(){return o.ZP.create(this.tbody,{animation:0,draggable:"tr",handle:this.opts.handler,filter:function(t,e,n){if(e.classList.contains(this.opts.disabledClass))return!0;const o=e.querySelector(this.opts.handler);return!(!o||!o.classList.contains(this.opts.disabledClass))||void 0}.bind(this),ghostClass:"sortable-ghost",onStart:this._onStart.bind(this),onMove:this._onMove.bind(this),onEnd:this._onEnd.bind(this)})},a.prototype._onStart=function(t){const e=this.tbody.querySelectorAll("tr");this.opts.tree&&(this.tree=new r(e));const n=parseInt(t.item.dataset.parent);e.forEach(function(t){const e=parseInt(t.dataset.parent);isNaN(e)&&isNaN(n)||e===n||t.classList.add(this.opts.disabledClass)}.bind(this))},a.prototype._onMove=function(t){return!t.related.classList.contains(this.opts.disabledClass)},a.prototype._onEnd=function(t){this.tbody.querySelectorAll("tr").forEach(function(t){t.classList.remove(this.opts.disabledClass)}.bind(this));const e=this._getMovedRows(t);if(!e.length||1===e.length)return;this._normalizeTable(t,e);const n=this._createOrderMap(t,e),o=this.tbody.querySelectorAll(this.opts.handler);o.forEach(function(t){t.classList.add(this.opts.disabledClass)}.bind(this)),this._sendRequest(n).then(function(){o.forEach(function(t){t.classList.remove(this.opts.disabledClass)}.bind(this))}.bind(this))},a.prototype._getMovedRows=function(t){const e=Math.min(t.oldIndex,t.newIndex),n=Math.max(t.oldIndex,t.newIndex),o=this.tbody.querySelectorAll("tr");let s=Array.prototype.slice.call(o,e,n+1);if(this.tree){const e=parseInt(t.item.dataset.id),n=this.tree.getNode(e);s=s.filter((function(t){return parseInt(t.dataset.parent)===n.parent}))}return s},a.prototype._createOrderMap=function(t,e){const n=[],o=[];e.forEach(function(t){t.querySelector(this.opts.handler)&&(n.push(parseInt(t.dataset.id)),o.push(parseInt(t.dataset.orderValue)))}.bind(this));return t.oldIndex<t.newIndex?o.unshift(o.pop()):o.push(o.shift()),n.reduce(function(t,e,n){t[e]=o[n];return this.tbody.querySelector("tr[data-id='"+e+"']").setAttribute("data-order-value",o[n]),t}.bind(this),{})},a.prototype._normalizeTable=function(t,e){if(this.tree){const n=parseInt(t.item.dataset.id),o=this.tree.getNode(n),s=t.item.previousElementSibling,r=t.item.nextElementSibling,a=e.slice();if(s&&r){const t=parseInt(s.dataset.parent)===o.parent,e=parseInt(r.dataset.parent)===parseInt(s.dataset.id);t&&e&&a.indexOf(s)<0&&a.unshift(s)}a.forEach(function(t){const e=parseInt(t.dataset.id),n=this.tree.getDescendants(e);Element.prototype.after.apply(t,n)}.bind(this))}},a.prototype._sendRequest=function(t){return fetch(this.opts.url,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){if(!t.ok){const e=new Error(`${t.status} ${t.statusText}`);throw e.response=t,e}}))};var i=a,c=n(4027);const l="action-toggle",d="paper-actions__counter",u="paper-actions__question",h="paper-actions__all",f="paper-actions__clear";function p(t,e){t.forEach((function(t){t&&"TR"===t.tagName&&t.dispatchEvent(new CustomEvent("select",{bubbles:!0,cancelable:!0,detail:{state:e}}))}))}function y(t){const e=t.reduce(((t,e)=>t+(e.checked?1:0)),0);document.querySelectorAll(`.${d}`).forEach((function(t){t.innerHTML=interpolate(ngettext("%(sel)s of %(cnt)s selected","%(sel)s of %(cnt)s selected",e),{sel:e,cnt:t.dataset.actionsIcnt},!0)})),e===t.length?document.querySelectorAll(`.${u}`).forEach((function(t){t.hidden=!1})):b(t)}function m(t){document.querySelectorAll(".paper-actions__select_across input.select-across").forEach((function(e){e.value=Number(t)}))}function b(t){m(!1);document.querySelectorAll(`.${d}`).forEach((function(t){t.hidden=!1}));document.querySelectorAll(`.${h}`).forEach((function(t){t.hidden=!0}));const e=t.reduce(((t,e)=>t+(e.checked?1:0)),0);document.querySelectorAll(`.${u}`).forEach((function(n){n.hidden=e!==t.length}));document.querySelectorAll(`.${f}`).forEach((function(t){t.hidden=!0}))}const g=document.querySelectorAll(".action-select");g.length&&function(t){let e=null;const n=document.getElementById("result_list"),o=document.getElementById(l);o.addEventListener("change",(function(){const e=t.map((t=>t.closest("tr")));p(e,this.checked),y(t)})),n.addEventListener("select",(function(e){const s=e.target;if("TR"!==s.tagName||s.closest("table")!==n)return;const r=Boolean(e.detail.state);s.querySelector(".action-select").checked=r,s.classList.toggle("selected",r),o.checked=null==t.find((t=>!t.checked))})),n.addEventListener("click",(function(n){const o=n.target,s=o.closest("tr");if(!s)return;const r=o.closest(".action-checkbox .custom-control"),a=s.querySelector(".action-select");if(n.shiftKey&&e){const n=t.indexOf(e),o=t.indexOf(a),s=Math.min(n,o),r=Math.max(n,o),i=t.slice(s,r+1).map((t=>t.closest("tr")));p(i,e.checked)}else(r||n.ctrlKey&&!n.shiftKey)&&(e=a,p([s],!a.checked));y(t)})),n.addEventListener("mousedown",(function(t){const e=t.target;!t.shiftKey||"TD"!==e.tagName&&"TH"!==e.tagName||t.preventDefault()})),document.addEventListener("click",(function(t){const e=t.target;"A"===e.tagName&&e.closest(`.${u}`)&&(t.preventDefault(),m(!0),document.querySelectorAll(`.${d}`).forEach((function(t){t.hidden=!0})),document.querySelectorAll(`.${h}`).forEach((function(t){t.hidden=!1})),document.querySelectorAll(`.${u}`).forEach((function(t){t.hidden=!0})),document.querySelectorAll(`.${f}`).forEach((function(t){t.hidden=!1})))})),document.addEventListener("click",(function(e){const n=e.target;if("A"===n.tagName&&n.closest(`.${f}`)){e.preventDefault(),o.checked=!1;const n=t.map((t=>t.closest("tr")));p(n,!1),b(t),y(t)}})),function(){let t=!1;document.getElementById("changelist-form").addEventListener("change",(function(e){const n=e.target;"INPUT"===n.tagName?n.closest(".action-select")||n.id===l||(t=!0):"SELECT"===n.tagName&&n.closest(".action-action")||(t=!0)})),document.addEventListener("click",(function(e){e.target.closest('[name="index"]')&&t&&(confirm(gettext("You have unsaved changes on individual editable fields. If you run an action, your unsaved changes will be lost."))||e.preventDefault())})),document.addEventListener("click",(function(e){const n=e.target.closest('[name="_save"]'),o=document.querySelectorAll('.actions select[name="action"]'),s=!Array.prototype.every.call(o,(function(t){return!t.value}));if(n&&s){let n;n=t?confirm(gettext("You have selected an action, but you haven't saved your changes to individual fields yet. Please click OK to save. You'll need to re-run the action.")):confirm(gettext("You have selected an action, and you haven't made any changes on individual fields. You're probably looking for the Go button rather than the Save button.")),n||e.preventDefault()}}))}()}(Array.from(g));n(7758);const _=document.querySelector(".paper-search-form"),v=_&&_.querySelector(".form-control");v&&v.addEventListener("focus",(function(){this.select()}));var E=n(1976),S=n(6410),k=n(5932);class w extends k.Z{constructor(t){super(),this.opts=Object.assign({altInput:!0,locale:this._getLocale(),dateFormat:this._getDateFormat()},t)}_init(t){const e=t.querySelector("[data-range-start]"),n=Object.assign({},this.opts);(0,E.Gn)(e,n);const o=t.querySelector("[data-range-end]"),s=Object.assign({},this.opts);(0,E.Gn)(o,s),t.addEventListener("click",(function(t){const e=t.target.closest("[data-today]");if(e){const t=e.closest(".input-group"),n=t&&t.querySelector("input");n&&n._flatpickr&&n._flatpickr.setDate("today")}}))}_destroy(t){const e=t.querySelector("[data-range-start]");e._flatpickr&&e._flatpickr.destroy();const n=t.querySelector("[data-range-end]");n._flatpickr&&n._flatpickr.destroy()}_getLocale(){for(const t of(0,S.Z)())if(E.Gn.l10ns[t])return t;return"default"}_getDateFormat(){for(const t of(0,S.Z)())if(E.fK[t])return E.fK[t];return"Y-m-d"}}const q=new w;q.observe(".paper-date-range-filter"),q.initAll(".paper-date-range-filter");const A=new c.C({width:"100%",allowClear:!0,containerCssClass:"select2-container--small"});A.observe(".paper-select2-filter select"),A.initAll(".paper-select2-filter select");const L=new c.C({width:"",allowClear:!0,containerCssClass:"select2-container--small"});L.observe(".paper-table .select-field select"),L.initAll(".paper-table .select-field select");const I=new c.C({allowClear:!0,containerCssClass:"select2-container--small",minimumResultsForSearch:1/0});I.observe(".paper-actions select"),I.initAll(".paper-actions select");const N=document.getElementById("result_list");N&&N.classList.contains("paper-table--sortable")&&new i(N,{url:N.dataset.orderUrl,tree:N.classList.contains("paper-table--tree"),handler:".paper-table__sort-handler"})}}]);
//# sourceMappingURL=changelist.9fd3d09927218a3dc095.js.map