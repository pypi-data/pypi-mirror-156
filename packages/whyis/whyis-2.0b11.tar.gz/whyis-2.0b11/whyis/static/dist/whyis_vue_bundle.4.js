(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1139:function(n,t,e){"use strict";e(686)},1140:function(n,t,e){"use strict";e.r(t);var a=e(2),s=e.n(a),i=e(3),r=e.n(i)()(s.a);r.push([n.i,".sparql-template-page[data-v-f1f1c9dc]{max-width:960px;margin:auto}.display[data-v-f1f1c9dc]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;height:18em}.display .template-next[data-v-f1f1c9dc]{order:1}.display .display-text[data-v-f1f1c9dc]{max-height:calc(100% - 60px);overflow:auto;margin:30px;font-size:16px;line-height:40px}.display-count-indicator[data-v-f1f1c9dc]{text-align:center;margin-bottom:20px;font-weight:500}.accordion[data-v-f1f1c9dc]{margin-bottom:20px}","",{version:3,sources:["webpack://./sparql-template-page.vue"],names:[],mappings:"AA8QA,uCACE,eAAA,CACA,WAAA,CAEF,0BACE,YAAA,CACA,kBAAA,CACA,6BAAA,CACA,kBAAA,CACA,WAAA,CACA,yCACE,OAAA,CAEF,wCACE,4BAAA,CACA,aAAA,CACA,WAAA,CACA,cAAA,CACA,gBAAA,CAGJ,0CACE,iBAAA,CACA,kBAAA,CACA,eAAA,CAEF,4BACE,kBAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.sparql-template-page {\n  max-width: 960px;\n  margin: auto;\n}\n.display {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  height: 18em;\n  .template-next {\n    order: 1;\n  }\n  .display-text {\n    max-height: calc(100% - 60px);\n    overflow: auto;\n    margin: 30px;\n    font-size: 16px;\n    line-height: 40px;\n  }\n}\n.display-count-indicator {\n  text-align: center;\n  margin-bottom: 20px;\n  font-weight: 500;\n}\n.accordion {\n  margin-bottom: 20px;\n}\n"],sourceRoot:""}]),t.default=r},1185:function(n,t,e){"use strict";e.r(t);var a=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{staticClass:"sparql-template-page"},[n.loadingTemplates?e("div",[e("md-progress-spinner",{attrs:{"md-mode":"indeterminate"}})],1):0===n.totalTemplateCount?e("div",[e("p",[n._v("No templates were loaded")])]):e("div",[e("div",{staticClass:"button-row"},[e("div",[e("md-button",{staticClass:"md-icon-button",nativeOn:{click:function(t){return t.preventDefault(),n.selectQueryForVizEditor()}}},[e("md-tooltip",{staticClass:"utility-bckg",attrs:{"md-direction":"bottom"}},[n._v("\n            Select current query and return to Viz Editor\n          ")]),n._v(" "),e("md-icon",[n._v("check")])],1),n._v(" "),e("md-button",{staticClass:"md-icon-button",nativeOn:{click:function(t){return t.preventDefault(),n.toVizEditor()}}},[e("md-tooltip",{staticClass:"utility-bckg",attrs:{"md-direction":"bottom"}},[n._v(" Return to viz editor ")]),n._v(" "),e("md-icon",[n._v("arrow_back")])],1)],1)]),n._v(" "),e("md-toolbar",[e("h3",{staticClass:"md-title"},[n._v("Query Template")])]),n._v(" "),e("div",{staticClass:"display"},[e("md-button",{staticClass:"template-back",on:{click:function(t){return n.shiftTemplate(-1)}}},[e("md-icon",[n._v("chevron_left")])],1),n._v(" "),e("md-button",{staticClass:"template-next",on:{click:function(t){return n.shiftTemplate(1)}}},[e("md-icon",[n._v("chevron_right")])],1),n._v(" "),e("p",{staticClass:"display-text"},n._l(n.selectedTemplate.displaySegments,(function(t,a){return e("span",{key:a},[t.type==n.TextSegmentType.TEXT?e("span",{domProps:{innerHTML:n._s(t.text)}}):e("span",[e("select",{directives:[{name:"model",rawName:"v-model",value:n.varSelections[t.varName],expression:"varSelections[segment.varName]"}],attrs:{id:t.varName,name:t.varName},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(n){return n.selected})).map((function(n){return"_value"in n?n._value:n.value}));n.$set(n.varSelections,t.varName,e.target.multiple?a:a[0])}}},n._l(n.selectedTemplate.options[t.varName],(function(t,a){return e("option",{key:a,domProps:{value:a}},[n._v("\n                "+n._s(a)+"\n              ")])})),0)])])})),0)],1),n._v(" "),e("div",{staticClass:"display-count-indicator"},[e("p",[n._v("Query template "+n._s(n.currentIndex+1)+" of "+n._s(n.totalTemplateCount))])]),n._v(" "),n.query?e("div",{staticClass:"query"},[e("accordion",{attrs:{startOpen:!1,title:"SPARQL Query"}},[e("yasqe",{attrs:{value:n.query,readonly:"true"}})],1)],1):n._e(),n._v(" "),e("div",{staticClass:"results"},[e("accordion",{attrs:{startOpen:!0,title:"SPARQL Results"}},[n.results?e("div",[e("yasr",{attrs:{results:n.results}})],1):e("md-progress-spinner",{attrs:{"md-diameter":30,"md-stroke":3,"md-mode":"indeterminate"}})],1)],1)],1)])};a._withStripped=!0;var s=e(10),i=e(11),r=e(7),o=e(17),l=e(29);const p="http://schema.org/",c="http://spinrdf.org/sp",d=c+"in#";async function u(){const n=await Object(i.a)("PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX schema: <http://schema.org/>\nPREFIX sp: <http://spinrdf.org/sp>\nPREFIX spin: <http://spinrdf.org/spin#>\nPREFIX spl: <http://spinrdf.org/spin#>\nPREFIX whyis: <http://vocab.rpi.edu/whyis/>\nPREFIX nanomine_templates: <http://nanomine.org/query/>\n\nCONSTRUCT {\n    ?template a whyis:SparqlTemplate  ;\n        spin:labelTemplate ?labelTemplate ;\n        sp:text ?query ;\n        spin:constraint ?constraint .\n    ?constraint sp:varName ?varName ;\n        schema:option ?option .\n    ?option rdfs:label ?optLabel ;\n        schema:value ?optValue ;\n        schema:identifier ?optId ;\n        schema:position ?optPosition .\n}\nWHERE {\n    ?template a whyis:SparqlTemplate  ;\n        spin:labelTemplate ?labelTemplate ;\n        sp:text ?query ;\n        spin:constraint ?constraint .\n    ?constraint sp:varName ?varName ;\n        schema:option ?option .\n    ?option rdfs:label ?optLabel ;\n        schema:position ?optPosition .\n    OPTIONAL { ?option schema:value ?optValue } .\n    OPTIONAL { ?option schema:identifier ?optId } .\n}\n",{accept:"application/rdf+json"}),t={},e=[];n.results.bindings.forEach(n=>{const a=n.subject.value,s=n.predicate.value;let i=n.object.value;"literal"===n.object.type&&n.object.datatype&&(i=Object(l.fromRdf)(Object(o.literal)(i,Object(o.namedNode)(n.object.datatype)))),"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===s&&"http://vocab.rpi.edu/whyis/SparqlTemplate"===i&&e.push(a);let r=t[a];r||(r={},t[a]=r);let p=r[s];p||(p=new Set,r[s]=p),p.add(i)});const a=e.map(n=>function n(e,a){if((a=a||new Set).has(e)||!t.hasOwnProperty(e))return e;a.add(e);const s=t[e],i={uri:e};return Object.entries(s).forEach(([t,e])=>{const s=[...e].map(t=>n(t,a));i[t]=s}),i}(n)).map(f);return a.sort((n,t)=>n.id>t.id?1:-1),a}const m=Object.freeze({VAR:"var",TEXT:"text"}),h=Object.freeze({ANY:"any",LITERAL:"literal",IDENTIFIER:"identifier"});function f(n){const t=n[d+"labelTemplate"][0];return{id:n.uri,display:t,displaySegments:g(t),SPARQL:n[c+"text"][0],options:(e=n[d+"constraint"],Object.fromEntries(e.map(n=>{return[n[c+"varName"][0],(t=n[p+"option"],Object.fromEntries(t.map(n=>[n["http://www.w3.org/2000/01/rdf-schema#label"][0],A(n),n[p+"position"][0]]).sort((n,t)=>n[2]>t[2]?1:-1)))];var t})))};var e}function A(n){let t={type:h.ANY};if(n[p+"value"]){n[p+"value"];t={type:h.LITERAL,value:n[p+"value"][0]}}else n[p+"identifier"]&&(t={type:h.IDENTIFIER,value:n[p+"identifier"][0]});return t}const v=/{\?([^}]+)}/g,y=new RegExp(v.source+"|[^{]+","g");function g(n){return n.match(y).map(n=>{let t;const e=v.exec(n);return t=e?{type:m.VAR,varName:e[1]}:{type:m.TEXT,text:n},t})}var T=e(337);var b={data(){return{loadingTemplates:!0,queryTemplates:{},TextSegmentType:m,selTemplateId:null,query:"",varSelections:{},results:null,execQueryDebounced:Object(T.a)(this.execQuery,300)}},computed:{templateIds(){return Object.keys(this.queryTemplates)},selectedTemplate(){return this.queryTemplates[this.selTemplateId]},currentIndex(){return this.templateIds.indexOf(this.selTemplateId)},totalTemplateCount(){return this.templateIds.length}},methods:{...Object(s.d)("vizEditor",["setQuery"]),selectQueryForVizEditor(){this.setQuery(this.query),this.toVizEditor()},toVizEditor(){Object(r.f)(r.b.CHART_EDITOR,r.a.NEW)},async loadSparqlTemplates(){this.loadingTemplates=!0;try{const n=await u();this.queryTemplates={},n.forEach(n=>this.queryTemplates[n.id]=n),console.log("qtemps",this.queryTemplates),this.selTemplateId=n.length>0?n[0].id:null}finally{this.loadingTemplates=!1}},shiftTemplate(n){let t=this.currentIndex+n;for(;t>=this.totalTemplateCount;)t-=this.totalTemplateCount;for(;t<0;)t+=this.totalTemplateCount;this.selTemplateId=this.templateIds[t],console.log("shifted",t,this.selTemplateId,this.templateIds)},populateSelections(){this.selectedTemplate&&(this.varSelections=Object.fromEntries(Object.entries(this.selectedTemplate.options).map(([n,t])=>[n,Object.keys(t)[0]])))},getOptVal(n,t){return this.selectedTemplate.options[n][t]},buildQuery(){if(!this.selectedTemplate)return;this.query=this.selectedTemplate.SPARQL,this.selectedTemplate.options;const n=Object.fromEntries(Object.entries(this.varSelections).filter(n=>this.getOptVal(...n).type!==h.ANY));if(Object.keys(n).length>0){const t=Object.keys(n).map(n=>"?"+n).join(" "),e=Object.entries(n).map(n=>{const t=this.getOptVal(...n);let e;if(t.type===h.LITERAL)e=t.value,"number"!=typeof e&&(e=`"${e}"`);else{if(t.type!==h.IDENTIFIER)throw"Unknown option value type: "+t.type;e=`<${t.value}>`}return e}).join(" ");this.query+=`\nVALUES (${t}) {\n  (${e})\n}\n`}},async execQuery(){console.log("querying...."),this.results=null,this.results=await Object(i.a)(this.query),console.log("done",this.results)}},created(){this.loadSparqlTemplates()},watch:{selectedTemplate:{handler:"populateSelections"},varSelections:{handler:"buildQuery",deep:!0},query:{handler:"execQueryDebounced"}}},C=(e(1139),e(1)),x=Object(C.a)(b,a,[],!1,null,"f1f1c9dc",null);x.options.__file="js/whyis_vue/components/pages/sparql-templates/sparql-template-page.vue";t.default=x.exports},337:function(n,t,e){"use strict";function a(n,t){let e;return function(...a){clearTimeout(e),e=setTimeout(()=>n.apply(this,a),t)}}e.d(t,"a",(function(){return a}))},686:function(n,t,e){var a=e(1140);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);(0,e(8).default)("18114352",a,!1,{})}}]);