"use strict";(self.webpackChunk_tiledb_inc_pybabylonjs=self.webpackChunk_tiledb_inc_pybabylonjs||[]).push([[592],{18657:(e,t,n)=>{n.d(t,{Y:()=>a,o:()=>s});const i=n(4147),a=i.version,s=i.name},35592:(e,t,n)=>{n.r(t),n.d(t,{BabylonBaseModel:()=>C,BabylonImageModel:()=>M,BabylonImageView:()=>j,BabylonMBRSModel:()=>B,BabylonMBRSView:()=>T,BabylonPointCloudModel:()=>I,BabylonPointCloudView:()=>O});var i=n(8233),a=n(18657),s=n(12752),r=n(2759),o=(n(29085),n(7792),n(97924),n(93379)),l=n.n(o),c=n(7795),u=n.n(c),d=n(90569),h=n.n(d),p=n(3565),m=n.n(p),b=n(19216),v=n.n(b),y=n(44589),f=n.n(y),g=n(23889),_={};_.styleTagTransform=f(),_.setAttributes=m(),_.insert=h().bind(null,"head"),_.domAPI=u(),_.insertStyleElement=v(),l()(g.Z,_),g.Z&&g.Z.locals&&g.Z.locals;var w=n(15243),x=n.n(w),S=n(87401);class C extends i.DOMWidgetModel{}C.model_module=a.o,C.model_module_version=a.Y,C.view_module=a.o,C.view_module_version=a.Y,C.serializers=Object.assign({},i.DOMWidgetModel.serializers);class P extends i.DOMWidgetView{constructor(){super(...arguments),this.values=this.model.get("value"),this.width=this.values.width,this.height=this.values.height,this.wheelPrecision=this.values.wheel_precision,this.zScale=this.values.z_scale,this.inspector=this.values.inspector}resizeCanvas(){var e,t,n;null===(e=this.canvas)||void 0===e||e.setAttribute("width",this.width),null===(t=this.canvas)||void 0===t||t.setAttribute("height",this.height),null===(n=this.engine)||void 0===n||n.resize()}query_changed(){}render(){this.canvas=document.createElement("canvas"),this.canvas.classList.add("renderCanvas"),this.el.appendChild(this.canvas),this.model.on("change:query",this.query_changed,this),this.model.on_some_change(["width","height"],this.resizeCanvas,this),this.engine=new s.Engine(this.canvas,!0);const e=this.engine;s.SceneLoader.ShowLoadingScreen=!1,this.resizeCanvas(),this.createScene().then((t=>{e.runRenderLoop((()=>{t.render()}))}))}async createScene(){const e=new s.Scene(this.engine);return this.inspector&&e.debugLayer.show({embedMode:!0}),e}}class I extends C{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:I.model_name,_model_module:I.model_module,_model_module_version:I.model_module_version,_view_name:I.view_name,_view_module:I.view_module,_view_module_version:I.view_module_version})}}I.model_name="BabylonPointCloudModel",I.view_name="BabylonPointCloudView";class O extends P{async createScene(){return super.createScene().then((async e=>{var t,n=!1,i=!1,a=!1,o=!1;"time"===this.values.mode?n=!0:"classes"===this.values.mode?i=!0:"topo"==this.values.mode?a=!0:"gltf"==this.values.mode&&(o=!0);const l=(t="cloud"===this.values.source?await async function(e){var t,n;const i={apiKey:e.token},a=new(x())(i),s={layout:S.Layout.Unordered,ranges:[e.bbox.X,e.bbox.Y,e.bbox.Z],bufferSize:15e10,attributes:["X","Y","Z","Red","Green","Blue","GpsTime","Classification"]};try{for(var r,o=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,a){!function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)}(i,a,(t=e[n](t)).done,t.value)}))}}}(a.query.ReadQuery(e.name_space,e.array_name,s));!(r=await o.next()).done;)return r.value}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&await n.call(o)}finally{if(t)throw t.error}}}(this.values).then((e=>e)):this.values.data).X.length,c=this.values.gltf_data,u=this.values.point_size,d=t.GpsTime,h=this.values.time_offset,p=this.values.data.Classification,m=this.values.classes,b=this.values.topo_offset,v=this.zScale;let y=!1;const f=t.X.reduce(((e,t)=>Math.min(e,t))),g=t.X.reduce(((e,t)=>Math.max(e,t))),_=t.Y.reduce(((e,t)=>Math.min(e,t))),w=t.Y.reduce(((e,t)=>Math.max(e,t))),C=t.Red.reduce(((e,t)=>Math.max(e,t))),P=t.Green.reduce(((e,t)=>Math.max(e,t))),I=t.Blue.reduce(((e,t)=>Math.max(e,t))),O=Math.max(C,P,I);if(i)var B=new s.PointsCloudSystem("pcs",u,e,{updatable:i});else B=new s.PointsCloudSystem("pcs",u,e,{updatable:n});B.addPoints(l,(function(i,a,r){i.position=new s.Vector3(t.X[a],(t.Z[a]-b)*v,t.Y[a]),i.color=n?e.clearColor:new s.Color3(t.Red[a]/O,t.Green[a]/O,t.Blue[a]/O)}));let T=[B.buildMeshAsync()];if(o){var M=new Blob([c]),j=URL.createObjectURL(M);T.push(s.SceneLoader.AppendAsync(j,"",e,null,".gltf"))}if(await Promise.all(T),e.createDefaultCameraOrLight(!0,!0,!1),n||i){var R=r.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,e),L=new r.StackPanel;L.width="220px",L.horizontalAlignment=r.Control.HORIZONTAL_ALIGNMENT_CENTER,L.verticalAlignment=r.Control.VERTICAL_ALIGNMENT_BOTTOM,R.addControl(L);var N=new r.TextBlock;N.height="30px",N.color="white";var E=new r.Slider("Slider");if(E.minimum=0,E.step=1,E.height="20px",E.width="200px",n&&(N.text="Time: "+(h+d[0]).toFixed(2),E.maximum=d.length-1,E.value=0),i){N.text="All";var A=Array.from(new Set(p));E.maximum=A.length,E.value=A[0]}L.addControl(N),B.updateParticle=function(n){return n.color=y?e.clearColor:new s.Color3(t.Red[n.idx]/O,t.Green[n.idx]/O,t.Blue[n.idx]/O),n},E.onValueChangedObservable.add((function(e){if(n&&(N.text="Time: "+(h+d[e]).toFixed(2),e>B.counter?(y=!1,B.setParticles(B.counter,e)):(y=!0,B.setParticles(e,B.counter)),B.counter=e),i){var t=m.numbers.indexOf(A[e]);N.text=m.names[t];var a=p.indexOf(A[e]),s=p.lastIndexOf(A[e]);y=!0,B.setParticles(0,l),y=!1,B.setParticles(a,s)}})),L.addControl(E)}if(a){const t=this.values.mapbox_img;var J=new Blob([t]),k=URL.createObjectURL(J);const n=new s.StandardMaterial("mat",e);n.emissiveColor=s.Color3.Random(),n.diffuseTexture=new s.Texture(k,e),n.ambientTexture=new s.Texture(k,e);const i={xmin:f,zmin:_,xmax:g,zmax:w};s.MeshBuilder.CreateTiledGround("tiled ground",i,e).material=n}let D=e.activeCamera;return D.panningAxis=new s.Vector3(1,1,0),D.upperBetaLimit=Math.PI/2,D.panningSensibility=1,D.panningInertia=.2,D._panningMouseButton=0,this.wheelPrecision>0&&(D.wheelPrecision=this.wheelPrecision),D.alpha+=Math.PI,D.setTarget(new s.Vector3((f+g)/2,0,(_+w)/2)),D.attachControl(this.canvas,!1),e}))}}class B extends C{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:B.model_name,_model_module:B.model_module,_model_module_version:B.model_module_version,_view_name:B.view_name,_view_module:B.view_module,_view_module_version:B.view_module_version})}}B.model_name="BabylonMBRSModel",B.view_name="BabylonMBRSView";class T extends P{async createScene(){return super.createScene().then((e=>{const t=this.values.data,n=this.values.extents,i=n[0],a=n[1],r=n[2],o=n[3],l=n[4],c=Math.min(Math.max(a)-Math.min(i),Math.max(o)-Math.min(r)),u=this.zScale;e.createDefaultCameraOrLight(!0,!0,!0);let d=e.activeCamera;d.alpha+=Math.PI,d.upperBetaLimit=Math.PI/2,d.panningAxis=new s.Vector3(1,1,0),d.panningSensibility=.9,d.panningInertia=.2,d._panningMouseButton=0,this.wheelPrecision>0&&(d.wheelPrecision=this.wheelPrecision),d.setTarget(new s.Vector3(((a+i)/2-i)/c,0,((o+r)/2-r)/c)),d.attachControl(this.canvas,!1);var h=new s.StandardMaterial("mt1",e);h.alpha=.85,h.diffuseColor=new s.Color3(0,0,0),h.emissiveColor=new s.Color3(.5,.5,.5);const p=new s.SolidParticleSystem("SPS",e,{enableDepthSort:!0}),m=s.MeshBuilder.CreateBox("b",{height:1,width:1,depth:1});return p.addShape(m,t.Xmin.length),p.buildMesh().material=h,m.dispose(),p.initParticles=()=>{for(let e=0;e<p.nbParticles;e++){const n=p.particles[e];n.position.x=((t.Xmax[e]+t.Xmin[e])/2-i)/c,n.position.y=((t.Zmax[e]+t.Zmin[e])/2-l)/c*u,n.position.z=((t.Ymax[e]+t.Ymin[e])/2-r)/c,n.scaling.x=(t.Xmax[e]-t.Xmin[e])/c,n.scaling.y=(t.Zmax[e]-t.Zmin[e])/c*u,n.scaling.z=(t.Ymax[e]-t.Ymin[e])/c,n.color=new s.Color4(.5+.6*Math.random(),.5+.6*Math.random(),.5+.6*Math.random(),.9)}},p.initParticles(),p.setParticles(),e.registerBeforeRender((function(){p.setParticles()})),e}))}}class M extends C{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:M.model_name,_model_module:M.model_module,_model_module_version:M.model_module_version,_view_name:M.view_name,_view_module:M.view_module,_view_module_version:M.view_module_version})}}M.model_name="BabylonImageModel",M.view_name="BabylonImageView";class j extends P{async createScene(){return super.createScene().then((e=>{const t=this.values.data,n=this.values.xy_bbox;e.createDefaultCameraOrLight(!0,!0,!0),e.clearColor=new s.Color4(.95,.94,.92,1);var i=new Blob([t]),a=URL.createObjectURL(i);const r=new s.StandardMaterial("ground",e);r.diffuseTexture=new s.Texture(a,e),r.ambientTexture=new s.Texture(a,e),r.ambientColor=new s.Color3(.5,.5,.5),r.diffuseColor=new s.Color3(.8,.8,.8),r.specularColor=new s.Color3(.5,.5,.5),r.specularPower=32;const o=n[0],l=n[1],c=n[2],u=n[3];s.MeshBuilder.CreateGround("ground",{height:.005*(l-o),width:.005*(u-c),subdivisions:36},e).material=r;let d=e.activeCamera;return d.panningAxis=new s.Vector3(1,1,0),d.upperBetaLimit=Math.PI/2,d.panningSensibility=1,d.panningInertia=.2,d._panningMouseButton=0,this.wheelPrecision>0&&(d.wheelPrecision=this.wheelPrecision),d.alpha+=Math.PI,d.attachControl(this.canvas,!1),e}))}}},7792:(e,t,n)=>{n.d(t,{X:()=>i,b:()=>u});var i,a=n(74141),s=n(18810),r=n(30475),o=n(46814),l=n(10661),c=n(32733);Object.defineProperty(o.x.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new u(this)),this._debugLayer},enumerable:!0,configurable:!0}),function(e){e[e.Properties=0]="Properties",e[e.Debug=1]="Debug",e[e.Statistics=2]="Statistics",e[e.Tools=3]="Tools",e[e.Settings=4]="Settings"}(i||(i={}));var u=function(){function e(e){var t=this;this.BJSINSPECTOR=this._getGlobalInspector(),this._scene=e||c.l.LastCreatedScene,this._scene&&this._scene.onDisposeObservable.add((function(){t._scene._debugLayer&&t._scene._debugLayer.hide()}))}return Object.defineProperty(e.prototype,"onPropertyChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable:(this._onPropertyChangedObservable||(this._onPropertyChangedObservable=new r.y$),this._onPropertyChangedObservable)},enumerable:!1,configurable:!0}),e.prototype._createInspector=function(e){if(!this.isVisible()){if(this._onPropertyChangedObservable){for(var t=0,n=this._onPropertyChangedObservable.observers;t<n.length;t++){var i=n[t];this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable.add(i)}this._onPropertyChangedObservable.clear(),this._onPropertyChangedObservable=void 0}var s=(0,a.pi)({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},e);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,s)}},e.prototype.select=function(e,t){this.BJSINSPECTOR&&(t&&("[object String]"==Object.prototype.toString.call(t)?this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(t):this.BJSINSPECTOR.Inspector.MarkMultipleLineContainerTitlesForHighlighting(t)),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(e))},e.prototype._getGlobalInspector=function(){return"undefined"!=typeof INSPECTOR?INSPECTOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.Inspector?BABYLON:void 0},e.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},e.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},e.prototype.setAsActiveScene=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector._SetNewScene(this._scene)},e.prototype.show=function(t){var n=this;return new Promise((function(i){if(void 0===n.BJSINSPECTOR){var a=t&&t.inspectorURL?t.inspectorURL:e.InspectorURL;s.w1.LoadScript(a,(function(){n._createInspector(t),i(n)}))}else n._createInspector(t),i(n)}))},e.InspectorURL="https://unpkg.com/babylonjs-inspector@".concat(l.D.Version,"/babylon.inspector.bundle.js"),e}()},23889:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(8081),a=n.n(i),s=n(23645),r=n.n(s)()(a());r.push([e.id,"#renderCanvas {\n  width: 100%;\n  height: 100%;\n  touch-action: none;\n}\n",""]);const o=r},23645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,a,s){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(i)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(r[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&r[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),a&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=a):u[4]="".concat(a)),t.push(u))}},t}},8081:e=>{e.exports=function(e){return e[1]}},93379:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var s={},r=[],o=0;o<e.length;o++){var l=e[o],c=i.base?l[0]+i.base:l[0],u=s[c]||0,d="".concat(c," ").concat(u);s[c]=u+1;var h=n(d),p={css:l[1],media:l[2],sourceMap:l[3]};-1!==h?(t[h].references++,t[h].updater(p)):t.push({identifier:d,updater:a(p,i),references:1}),r.push(d)}return r}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var s=i(e=e||[],a=a||{});return function(e){e=e||[];for(var r=0;r<s.length;r++){var o=n(s[r]);t[o].references--}for(var l=i(e,a),c=0;c<s.length;c++){var u=n(s[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}s=l}}},90569:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},19216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},3565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i=n.css,a=n.media,s=n.sourceMap;a?e.setAttribute("media",a):e.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(i,e)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},44589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},4147:e=>{e.exports=JSON.parse('{"name":"@tiledb-inc/pybabylonjs","version":"1.1.0-beta.0","description":"BabylonJS widget","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css","style/*.css","style/index.js"],"author":{"name":"TileDB","email":"support@tiledb.com"},"homepage":"https://github.com/TileDB-Inc/PyBabylonJS","bugs":{"url":"https://github.com/TileDB-Inc/PyBabylonJS/issues"},"license":"MIT","main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/TileDB-Inc/PyBabylonJS"},"scripts":{"build":"jlpm run build:lib && jlpm run build:labextension:dev","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:dist":"NODE_OPTIONS=--max-old-space-size=4096 webpack --mode=production","build:prod":"jlpm run clean && jlpm run build:lib && jlpm run build:labextension && jlpm run build:dist","clean":"jlpm run clean:lib","clean:lib":"rimraf lib tsconfig.tsbuildinfo","clean:labextension":"rimraf pybabylonjs/labextension","clean:all":"jlpm run clean:lib && jlpm run clean:labextension","clean:nbextension":"rimraf pybabylonjs/nbextension/static/index.js","eslint":"eslint . --ext .ts,.tsx --fix","eslint:check":"eslint . --ext .ts,.tsx","install:extension":"jlpm run build","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"yarn run build:lib","test":"echo test","watch":"run-p watch:src watch:labextension","watch:src":"tsc -w","watch:labextension":"jupyter labextension watch .","watch:lib":"tsc -w","watch:nbextension":"NODE_OPTIONS=--max-old-space-size=4096 webpack --watch --mode=development"},"dependencies":{"@babylonjs/core":"^5.0.0","@babylonjs/inspector":"^5.0.0","@babylonjs/loaders":"^5.0.0","@jupyter-widgets/base":"^1.1.10 || ^2 || ^3 || ^4","@jupyterlab/application":"^3.2.0","@tiledb-inc/tiledb-cloud":"^1.0.8","babylonjs-gui":"^4.2.1","babylonjs-materials":"^5.0.0"},"devDependencies":{"@jupyterlab/builder":"^3.1.0","@types/node":"^10.11.6","@types/webpack-env":"^1.16.3","@typescript-eslint/eslint-plugin":"^4.8.1","@typescript-eslint/parser":"^4.8.1","crypto":"1.0.1","css-loader":"^6.3.0","eslint":"^7.14.0","eslint-config-prettier":"^6.15.0","eslint-plugin-prettier":"^3.1.4","expect.js":"^0.3.1","fs-extra":"^7.0.0","git-tag-version":"^1.3.1","mkdirp":"^0.5.1","npm-run-all":"^4.1.5","prettier":"^2.1.1","rimraf":"^3.0.2","source-map-loader":"^3.0.0","style-loader":"^3.2.1","svg-url-loader":"^7.1.1","ts-loader":"^9.2.5","typescript":"~4.1.3","webpack":"^5.53.0","webpack-cli":"^4.8.0"},"jupyterlab":{"extension":"lib/plugin","outputDir":"pybabylonjs/labextension"},"styleModule":"style/index.js"}')}}]);